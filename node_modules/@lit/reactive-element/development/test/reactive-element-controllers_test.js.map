{"version":3,"file":"reactive-element-controllers_test.js","sourceRoot":"","sources":["../../src/test/reactive-element-controllers_test.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\nimport {\n  PropertyValues,\n  ReactiveElement,\n  Controller,\n} from '../reactive-element.js';\nimport {generateElementName} from './test-helpers.js';\nimport {assert} from '@esm-bundle/chai';\n\nsuite('ReactiveElement controllers', () => {\n  class MyController implements Controller {\n    host: ReactiveElement;\n    willUpdateCount = 0;\n    updateCount = 0;\n    updatedCount = 0;\n    connectedCount = 0;\n    disconnectedCount = 0;\n    callbackOrder: string[] = [];\n\n    constructor(host: ReactiveElement) {\n      this.host = host;\n      this.host.addController(this);\n    }\n\n    connectedCallback() {\n      this.connectedCount++;\n      this.callbackOrder.push('connectedCallback');\n    }\n\n    disconnectedCallback() {\n      this.disconnectedCount++;\n      this.callbackOrder.push('disconnectedCallback');\n    }\n\n    willUpdate() {\n      this.willUpdateCount++;\n      this.callbackOrder.push('willUpdate');\n    }\n\n    update() {\n      this.updateCount++;\n      this.callbackOrder.push('update');\n    }\n\n    updated() {\n      this.updatedCount++;\n      this.callbackOrder.push('updated');\n    }\n  }\n\n  class A extends ReactiveElement {\n    static properties = {foo: {}};\n    foo = 'foo';\n    willUpdateCount = 0;\n    updateCount = 0;\n    updatedCount = 0;\n    connectedCount = 0;\n    disconnectedCount = 0;\n\n    controller = new MyController(this);\n\n    connectedCallback() {\n      this.connectedCount++;\n      super.connectedCallback();\n    }\n\n    disconnectedCallback() {\n      this.disconnectedCount++;\n      super.disconnectedCallback();\n    }\n\n    willUpdate(changedProperties: PropertyValues) {\n      this.willUpdateCount++;\n      super.willUpdate(changedProperties);\n    }\n\n    update(changedProperties: PropertyValues) {\n      this.updateCount++;\n      super.update(changedProperties);\n    }\n\n    updated(changedProperties: PropertyValues) {\n      this.updatedCount++;\n      super.updated(changedProperties);\n    }\n  }\n  customElements.define(generateElementName(), A);\n\n  let container: HTMLElement;\n  let el!: A;\n\n  setup(async () => {\n    container = document.createElement('div');\n    document.body.appendChild(container);\n    el = new A();\n    container.appendChild(el);\n    await el.updateComplete;\n  });\n\n  teardown(() => {\n    if (container && container.parentNode) {\n      container.parentNode.removeChild(container);\n    }\n  });\n\n  test('controllers can implement connectedCallback/disconnectedCallback', () => {\n    assert.equal(el.connectedCount, 1);\n    assert.equal(el.disconnectedCount, 0);\n    assert.equal(el.controller.connectedCount, 1);\n    assert.equal(el.controller.disconnectedCount, 0);\n    container.removeChild(el);\n    assert.equal(el.connectedCount, 1);\n    assert.equal(el.disconnectedCount, 1);\n    assert.equal(el.controller.connectedCount, 1);\n    assert.equal(el.controller.disconnectedCount, 1);\n    container.appendChild(el);\n    assert.equal(el.connectedCount, 2);\n    assert.equal(el.disconnectedCount, 1);\n    assert.equal(el.controller.connectedCount, 2);\n    assert.equal(el.controller.disconnectedCount, 1);\n  });\n\n  test('controllers can implement willUpdate/update/updated', async () => {\n    assert.equal(el.willUpdateCount, 1);\n    assert.equal(el.updateCount, 1);\n    assert.equal(el.updatedCount, 1);\n    assert.equal(el.controller.willUpdateCount, 1);\n    assert.equal(el.controller.updateCount, 1);\n    assert.equal(el.controller.updatedCount, 1);\n    el.foo = 'new';\n    await el.updateComplete;\n    assert.equal(el.willUpdateCount, 2);\n    assert.equal(el.updateCount, 2);\n    assert.equal(el.updatedCount, 2);\n    assert.equal(el.controller.willUpdateCount, 2);\n    assert.equal(el.controller.updateCount, 2);\n    assert.equal(el.controller.updatedCount, 2);\n  });\n\n  test('controllers callback order', async () => {\n    assert.deepEqual(el.controller.callbackOrder, [\n      'connectedCallback',\n      'willUpdate',\n      'update',\n      'updated',\n    ]);\n    el.controller.callbackOrder = [];\n    el.foo = 'new';\n    await el.updateComplete;\n    assert.deepEqual(el.controller.callbackOrder, [\n      'willUpdate',\n      'update',\n      'updated',\n    ]);\n    el.controller.callbackOrder = [];\n    container.removeChild(el);\n    assert.deepEqual(el.controller.callbackOrder, ['disconnectedCallback']);\n  });\n});\n"]}