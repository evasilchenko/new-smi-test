{"version":3,"file":"style-map.js","sources":["../src/directives/style-map.ts"],"sourcesContent":["/**\n * @license\n * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\nimport {AttributePart, noChange} from '../lit-html.js';\nimport {\n  directive,\n  Directive,\n  DirectiveParameters,\n  PartInfo,\n  PartType,\n} from '../directive.js';\n\n/**\n * A key-value set of CSS properties and values.\n *\n * The key should be either a valid CSS property name string, like\n * `'background-color'`, or a valid JavaScript camel case property name\n * for CSSStyleDeclaration like `backgroundColor`.\n */\nexport interface StyleInfo {\n  readonly [name: string]: string;\n}\n\nclass StyleMap extends Directive {\n  previousStyleProperties?: Set<string>;\n\n  constructor(partInfo: PartInfo) {\n    super(partInfo);\n    if (\n      partInfo.type !== PartType.ATTRIBUTE ||\n      partInfo.name !== 'style' ||\n      (partInfo.strings?.length as number) > 2\n    ) {\n      throw new Error(\n        'The `styleMap` directive must be used in the `style` attribute ' +\n          'and must be the only part in the attribute.'\n      );\n    }\n  }\n\n  render(styleInfo: StyleInfo) {\n    return Object.keys(styleInfo).reduce((style, prop) => {\n      const value = styleInfo[prop];\n      if (value === null) {\n        return style;\n      }\n      // Convert property names from camel-case to dash-case, i.e.:\n      //  `backgroundColor` -> `background-color`\n      // Vendor-prefixed names need an extra `-` appended to front:\n      //  `webkitAppearance` -> `-webkit-appearance`\n      // Exception is any property name containing a dash, including\n      // custom properties; we assume these are already dash-cased i.e.:\n      //  `--my-button-color` --> `--my-button-color`\n      prop = prop\n        .replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g, '-$&')\n        .toLowerCase();\n      return style + `${prop}:${value};`;\n    }, '');\n  }\n\n  update(part: AttributePart, [styleInfo]: DirectiveParameters<this>) {\n    const {style} = part.element as HTMLElement;\n\n    if (this.previousStyleProperties === undefined) {\n      this.previousStyleProperties = new Set();\n      for (const name in styleInfo) {\n        this.previousStyleProperties.add(name);\n      }\n      return this.render(styleInfo);\n    }\n\n    // Remove old properties that no longer exist in styleInfo\n    // We use forEach() instead of for-of so that re don't require down-level\n    // iteration.\n    this.previousStyleProperties!.forEach((name) => {\n      if (!(name in styleInfo)) {\n        this.previousStyleProperties!.delete(name);\n        if (name.indexOf('-') === -1) {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          (style as any)[name] = null;\n        } else {\n          style.removeProperty(name);\n        }\n      }\n    });\n\n    // Add or update properties\n    for (const name in styleInfo) {\n      this.previousStyleProperties.add(name);\n      if (name.indexOf('-') === -1) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (style as any)[name] = styleInfo[name];\n      } else {\n        style.setProperty(name, styleInfo[name]);\n      }\n    }\n    return noChange;\n  }\n}\n\n/**\n * A directive that applies CSS properties to an element.\n *\n * `styleMap` can only be used in the `style` attribute and must be the only\n * expression in the attribute. It takes the property names in the `styleInfo`\n * object and adds the property values as CSS properties. Property names with\n * dashes (`-`) are assumed to be valid CSS property names and set on the\n * element's style object using `setProperty()`. Names without dashes are\n * assumed to be camelCased JavaScript property names and set on the element's\n * style object using property assignment, allowing the style object to\n * translate JavaScript-style names to CSS property names.\n *\n * For example `styleMap({backgroundColor: 'red', 'border-top': '5px', '--size':\n * '0'})` sets the `background-color`, `border-top` and `--size` properties.\n *\n * @param styleInfo\n */\nexport const styleMap = directive(StyleMap);\n"],"names":["styleMap","directive","Directive","[object Object]","partInfo","super","type","PartType","ATTRIBUTE","name","strings","length","Error","styleInfo","Object","keys","reduce","style","prop","value","replace","toLowerCase","part","element","undefined","this","previousStyleProperties","Set","add","render","forEach","delete","indexOf","removeProperty","setProperty","noChange"],"mappings":";;;;;;;;;;;;;SAgIaA,EAAWC,EA9FxB,cAAuBC,EAGrBC,YAAYC,GAEV,GADAC,MAAMD,GAEJA,EAASE,OAASC,EAASC,WACT,UAAlBJ,EAASK,MACRL,EAASM,SAASC,OAAoB,EAEvC,MAAUC,MACR,8GAMNT,OAAOU,GACL,OAAOC,OAAOC,KAAKF,GAAWG,QAAO,CAACC,EAAOC,KAC3C,MAAMC,EAAQN,EAAUK,GACxB,OAAc,OAAVC,EACKF,EAYFA,EAAQ,GAHfC,EAAOA,EACJE,QAAQ,oCAAqC,OAC7CC,iBACuBF,OACzB,IAGLhB,OAAOmB,GAAsBT,IAC3B,MAAMI,MAACA,GAASK,EAAKC,QAErB,QAAqCC,IAAjCC,KAAKC,wBAAuC,CAC9CD,KAAKC,wBAA0B,IAAIC,IACnC,IAAK,MAAMlB,KAAQI,EACjBY,KAAKC,wBAAwBE,IAAInB,GAEnC,OAAOgB,KAAKI,OAAOhB,GAMrBY,KAAKC,wBAAyBI,SAASrB,IAC/BA,KAAQI,IACZY,KAAKC,wBAAyBK,OAAOtB,IACV,IAAvBA,EAAKuB,QAAQ,KAEdf,EAAcR,GAAQ,KAEvBQ,EAAMgB,eAAexB,OAM3B,IAAK,MAAMA,KAAQI,EACjBY,KAAKC,wBAAwBE,IAAInB,IACN,IAAvBA,EAAKuB,QAAQ,KAEdf,EAAcR,GAAQI,EAAUJ,GAEjCQ,EAAMiB,YAAYzB,EAAMI,EAAUJ,IAGtC,OAAO0B"}